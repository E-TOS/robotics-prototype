<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ArmDriverUnit: C:/Users/vashm/Documents/git/robotics-prototype/robot/rover/ArmDriverUnit/Notes.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ArmDriverUnit
   </div>
   <div id="projectbrief">Firmware which controls a 6-dof robot arm</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('Notes_8h_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/vashm/Documents/git/robotics-prototype/robot/rover/ArmDriverUnit/Notes.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="Notes_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  TODO:</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">open loop speed and closed loop max speed are different????</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">-this is because closed loop has a max val whereas open loop has a fixed one, but these could maybe be the same???</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">stepper doesn&#39;t have speed the way servos and dcs do??????</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">-this is because stepper calculates speed using durations, but this means openloopgain and openloopspeed mean nothing for it???</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">7) openloopspeed right now is set in setup... but this defeats the purpose of initializing the speed to 0 in the constructor... i set it to 0 as a precaution but technically the motors shouldn&#39;t turn anyway because movementDone controls that. so maybe I can just initialize to 50 and not have it in the setup?</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">  10) should setOutputLimits be restricted to just pidcontroller or should it be something for all motors...?</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">      but then i set openloopspeed to 50 in the setup()???? i need to rethink the velocity vs speed vs direction stuff!</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">  24) maybe we should have some way of covering the limit switches - what if someone accidentally presses one?</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">  thushanth said the way that 3d printers work is they move away then slowly move back to hit the switch again as a check</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">  -(always) implement error checking, clean up code, comment code, make sure ISR variables are volatile</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">  -(done-ish) PID implemented for DC motor but need to adjust all variables</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">  -(depends on wiring) determine the actual clockwise and counter-clockwise directions of motors based on their wiring in the arm itself</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">  -(next) clean up parsing code to make it easier to read and reduce repetition</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">   -(issue) interrupt functions must be defined outside of classes...</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">   -(now) confirm all the pins will work with interrupts and not stepping on each other</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">   -(now) deal with overflow of encoderCount.. does it ever reach max value?</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">   -(later) determine whether it&#39;s worth it to use the built in quadrature decoders</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">   -(now) finish implementing homing functionality</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">  -(next next step) timers</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">  -watchdog timer to be added into my code soonish to reset the teensy if it&#39;s hanging</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">   -heartbeat will be implemented using millis as millis uses systick so do we really need to do interrupts?</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">   -lptmr runs even on low power mode, maybe this should be heartbeat instead?</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">   -pit is used for intervaltimer objects, there are 4 and they work like interrupts</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">   -pwm: teensy has 6 16bit pwm timers and apparently 22 total pwm options:</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">    -currently using whatever is connected to the pwm pins for timing pwm</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">    -teensy pwm page mentions ftm and tpm timers which aren&#39;t mentioned in the page with other timesr</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">    -ftm+tpm has quadrature decoder?</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">    -tpm is 2-8 channel timer with pwm, 16bit counter, 2 channels for pwm</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">  -even more notes in google drive</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">  </span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">  perhaps pinsetup.h &amp; pinsetup.cpp should be changed to motorsetup or just setup as it&#39;s also got angle limits and gear ratios</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">   </span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">   I need to figure out where it&#39;s a good idea to disable interrupts so htat I don&#39;t read a value while it&#39;s being modified</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">  6) angleTolerance is motorPID attribute and not motor attribute?</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">  DEAL WITH ANGLERESOLUTION VARIABLE IN PIDCONTROLLER</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">17) perhaps the initialization of motor angle parameters should be its own function</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">  18) perhaps the initialization of the motor&#39;s pins should also be its own function</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">  19) perhaps the constructor should take a series of structs, one for each type</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">  </span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">  20) fix that issue with discrepancy that&#39;s related to the periodic angle checks</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">  23) stepper motor angle checks for open loop control remains to be fixed, updated, implemented</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">  25) there should also be a check so that if the motor is moving away from the goal position or has been moving for a while without reaching the expected angle, it stops... like a timeout</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">27) what happens if a new command tells the motor to turn in opposite direction? abrupt changes are bad. if the stepper is trying to turn but hasn&#39;t gotten anywhere there should be a check in the microcontroller that there&#39;s an issue (there can also be a check in the gui)</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">  the base station/odroid should be in charge of ramping up angles and the teensy should just go to them</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">  perhaps if a large angle is requested there should still be a way to stop it though</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">  26) what do I do for angles over 360? do i keep counting up? do i keep count of how many rotations I&#39;ve done?</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">  </span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">  for encoder interrupt testing on the teensy, send 3.3v to all interrupt pins simultaneously to test thing?</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">  floating point math doesn&#39;t seem bad, but at worst, convert float to int before motor control and do int math inside interrupts</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">  we don&#39;t want to miss messages, we need to know if messages were missed, for example know starting and ending message characters, we need some kind of confirmation anyway</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">  quadrature on ftm1,2: pins 3/4,29/30: cant use for pwm anymore</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">  quadrature on tpm1,2: pins 16/17, (tpm2 not implemented in teensy?)</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">  for steppers the check is more to do with whether the amount of steps has been reached and if not, try to step more... whereas for dc they control voltage so the issue there is whether the pid tries to go to max voltage</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">  fuzzy logic followed by pid? just fuzzy logic? different pid constants based on how large the error is? small-medium error has large constants and medium high has smaller ones so it doesn&#39;t overreact?</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">  according to my googling, many people say that for steppers it&#39;s better to control them open-loop style until the very end of the motion, at which point you correct for errors based on the angle difference. This is partly because of the step angle resolution compared to the encoder resolution and pid output resolution causing instability since the PID tries to overcompensate too quickly?</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">  But since we have a gear/belt reduction, and since we can programmatically decide which errors we can ignore, maybe it&#39;s not as big of a deal and PID is okay... after all, we&#39;d have to manually implement stepper acceleration if we don&#39;t use a PID, although code examples do already exist.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">  make sure the math calculations are written correctly and calculate as quickly as possible</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">  for motor speed, use encoder to calculate speed like i did in MotorCharacterization</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">  speed should be calculated the way angle is, only when necessary in interrupt loop</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">  speed pid takes speed as measurement and compares to desired speed</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">  what&#39;s the relationship between position and speed that helps design the position pid</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">  different types of ramping profiles - trapezoid vs quintic polynomial? ramping of stepper should be linear, higher level ramping should occur in gui</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">*/</span></div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Notes_8h.html">Notes.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
